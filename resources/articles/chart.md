# Markdownドキュメントでのグラフ表示機能

この機能を使用すると、Markdownドキュメント内に簡易的なグラフを表示することができます。バニラJavaScriptを使用して実装されており、ダークモード対応しています。

## 使用可能なグラフの種類

現在、以下の3種類のグラフコンポーネントが用意されています：

1. **バーグラフ** (`x-chart.bar`) - データを棒グラフとして表示
2. **折れ線グラフ** (`x-chart.line`) - データを折れ線チャートとして表示 
3. **円グラフ** (`x-chart.pie`) - データを円グラフとして表示

## 使用方法

Markdownドキュメント内で、以下のように「blade」言語を指定したコードブロック内にBladeコンポーネントを記述します。

`:max-value`を指定しなければ適切に調整されて表示されるので通常は不要です。

````markdown
```blade
<x-chart.bar
  :data="[145937, 149540, 155972, 159780, 165442, 175829, 190949, 197708]"
  :labels="['2021年11月', '2022年3月', '2022年9月', '2023年3月', '2023年9月', '2024年3月', '2024年9月', '2025年3月']"
  :max-value="200000"
  title="障害福祉サービス市場の施設数推移"
/>
```
````

## グラフコンポーネントのパラメータ

### バーグラフ (`x-chart.bar`)

```blade
<x-chart.bar
  :data="[値1, 値2, 値3, ...]"
  :labels="['ラベル1', 'ラベル2', 'ラベル3', ...]"
  :max-value="最大値（省略可）"
  title="グラフタイトル（省略可）"
/>
```

#### 使用例

```blade
<x-chart.bar
  :data="[19919, 20213, 20815, 21370, 22194, 23827, 24448]"
  :labels="['2022年3月', '2022年9月', '2023年3月', '2023年9月', '2024年3月', '2024年9月', '2025年3月']"
  :max-value="25000"
  title="居宅介護サービス事業所数の推移"
/>
```

### 折れ線グラフ (`x-chart.line`)

```blade
<x-chart.line
  :data="[値1, 値2, 値3, ...]"
  :labels="['ラベル1', 'ラベル2', 'ラベル3', ...]"
  :max-value="最大値（省略可）"
  title="グラフタイトル（省略可）"
/>
```

#### 使用例

```blade
<x-chart.line
  :data="[1023194, 1067383, 1086380, 1127119, 1183220, 1287113, 1329969]"
  :labels="['2022年3月', '2022年9月', '2023年3月', '2023年9月', '2024年3月', '2024年9月', '2025年3月']"
  :max-value="1400000"
  title="障害福祉サービス総定員数の推移"
/>
```

### 円グラフ (`x-chart.pie`)

```blade
<x-chart.pie
  :data="[値1, 値2, 値3, ...]"
  :labels="['ラベル1', 'ラベル2', 'ラベル3', ...]"
  title="グラフタイトル（省略可）"
/>
```

#### 使用例

```blade
<x-chart.pie
  :data="[72747, 53503, 20415, 51043]"
  :labels="['株式会社', '社会福祉法人', 'NPO法人', 'その他']"
  title="運営法人形態別の施設数構成（2025年3月）"
/>
```

## 実際の表示例

以下は実際に表示されるグラフの例です。

### バーグラフ例

```blade
<x-chart.bar
  :data="[145937, 149540, 155972, 159780, 165442, 175829, 190949, 197708]"
  :labels="['2021年11月', '2022年3月', '2022年9月', '2023年3月', '2023年9月', '2024年3月', '2024年9月', '2025年3月']"
  :max-value="200000"
  title="障害福祉サービス市場の施設数推移"
/>
```

### 円グラフ例

```blade
<x-chart.pie
  :data="[79644, 55640, 18311, 44113]"
  :labels="['通所・日中活動系', '訪問系', '居住・入所系', '相談・支援系']"
  title="サービスカテゴリー別施設数（2025年3月）"
/>
```

## 特徴と機能

### ダークモード対応

すべてのグラフコンポーネントはダークモードに完全対応しています。ページのカラーモード（ライト/ダーク）に応じてグラフの色が自動的に調整されます。

* ライトモード：明るい背景に濃い色のグラフ要素
* ダークモード：暗い背景に明るい色のグラフ要素

ダークモードの自動検出と切り替えをサポートしているため、利用者がサイトのダークモードを切り替えると、グラフの表示も即座にそれに合わせて更新されます。

### インタラクティブ機能

* グラフ要素にホバーすると詳細データを表示
* タッチデバイスでも操作可能
* レスポンシブデザイン対応

## 注意事項

1. グラフは信頼できる記事内でのみ使用してください。`parse()` メソッドは信頼できるMarkdownファイル向けです。
2. この機能は `config/markdown.php` で許可されたコンポーネントのみ使用できます。
3. グラフデータは静的な値のみサポートしています（APIからの動的データの取得はできません）。
4. モバイル画面でも適切に表示されるようレスポンシブデザインになっています。

## 内部動作

この機能は以下のコンポーネントによって実現されています：

1. Bladeコンポーネント：
   - `resources/views/components/chart/base.blade.php` - 共通コンテナ
   - `resources/views/components/chart/bar.blade.php` - バーグラフ実装
   - `resources/views/components/chart/line.blade.php` - 折れ線グラフ実装
   - `resources/views/components/chart/pie.blade.php` - 円グラフ実装

2. CommonMarkエクステンション：
   - `App\Support\Markdown\Extension\BladeComponentsExtension`

3. 設定：
   - `config/markdown.php`（許可するコンポーネントを指定）

インライン HTML（含むバニラJavaScript）が使用できるため、Markdownドキュメントのセキュリティには十分注意してください。この機能は管理者が作成する信頼できるMarkdownファイルでのみ使用することを想定しています。
